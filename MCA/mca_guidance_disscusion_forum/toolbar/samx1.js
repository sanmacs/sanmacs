    function RTEUtilBeginScript()
    {
	return String.fromCharCode(60, 115, 99, 114, 105, 112, 116, 62);
    }

    function RTEUtilEndScript()
    {
	return String.fromCharCode(60, 47, 115, 99, 114, 105, 112, 116, 62);
    }

    function RTEUtilScript()
    {
	return String.fromCharCode(115, 99, 114, 105, 112, 116);
    }
    
	var rte_i18n_PhotoMailToolsButtonText = "PhotoMail Tools";
	var rte_i18n_PhotoMailToolsHoverText = "View PhotoMail Tools";	
	
    var rte_i18n_SpellCheck = "Spell Check";
    var rte_i18n_Cut = "Cut";
    var rte_i18n_Copy = "Copy";
    var rte_i18n_Paste = "Paste";
    var rte_i18n_FontFace = "Font Face";
    var rte_i18n_FontSize = "Font Size";
    var rte_i18n_Bold = "Bold";
    var rte_i18n_Italic = "Italic";
    var rte_i18n_Underline = "Underline";
    var rte_i18n_TextColor = "Text Color";
    var rte_i18n_HighlightColor = "Highlight Color";
    var rte_i18n_InsertEmoticon = "Insert Emoticon";
    var rte_i18n_CreateHyperlink = "Create Hyperlink";
    var rte_i18n_InsertImag = "Insert Image";
    var rte_i18n_AlignText = "Align Text";
    var rte_i18n_List = "List";
    var rte_i18n_DecreaseIndent = "Decrease Indent";
    var rte_i18n_IncreaseIndent = "Increase Indent";
    var rte_i18n_ApplyStationery = "Apply Stationery";
    var rte_i18n_Stationery = "Stationery";
    var rte_i18n_PhotoToolbar = "Photo Toolbar";
    var rte_i18n_StationerySplash = "";
    var rte_i18n_EnterLink = "enter link location (eg. http://www.yahoo.com):";
    var rte_i18n_CNFont1 = "cnfont1";
    var rte_i18n_CNFont2 = "cnfont2";
    var rte_i18n_CNFont3 = "cnfont3";
    var rte_i18n_CNFont4 = "cnfont4";
    var rte_i18n_CNFont5 = "cnfont5";
    var rte_i18n_KRFont1 = "krfont1";
    var rte_i18n_KRFont2 = "krfont2";
    var rte_i18n_KRFont3 = "krfont3";
    var rte_i18n_KRFont4 = "krfont4";
    var rte_i18n_KRFont5 = "krfont5";
    var rte_i18n_Size1 = "Size 1";
    var rte_i18n_Size2 = "Size 2";
    var rte_i18n_Size3 = "Size 3";
    var rte_i18n_Size4 = "Size 4";
    var rte_i18n_Size5 = "Size 5";
    var rte_i18n_Size6 = "Size 6";
    var rte_i18n_Size7 = "Size 7";
    var rte_i18n_FlushLeft = "Flush Left";
    var rte_i18n_Centered = "Centered";
    var rte_i18n_FlushRight = "Flush Right";
    var rte_i18n_NumberedList = "Numbered List";
    var rte_i18n_BulletedList = "Bulleted List";
    var rte_i18n_LearnMore = "Learn More";
    var rte_i18n_Edit = "Edit";
    var rte_i18n_BordersLabel = "Borders";
    var rte_i18n_BordersTooltip = "Add Borders";
    var rte_i18n_RotateLeft = "Rotate Left";
    var rte_i18n_RotateRight = "Rotate Right";
    var rte_i18n_Rotate = "Rotate";
    var rte_i18n_ResizeSmall = "Approximately 4 photos/line (90x90 each)";
    var rte_i18n_ResizeMedium = "Approximately 2 photos/line (120x120 each)";
    var rte_i18n_ResizeLarge = "Approximately 1 photo/line (180x180 each)";
    var rte_i18n_Layout = "Layout";
    var rte_i18n_Optimize = "Photo Quality";
    var rte_i18n_OptimizeNone = "Best for printing";
    var rte_i18n_OptimizeMedium = "Faster but printable";
    var rte_i18n_OptimizeHigh = "Fastest sending";
    var rte_i18n_WhatsThis = "[ What's This? ]";
    var rte_i18n_PhotosLinks = "Photos Links";
    var rte_i18n_PhotoMailLinksOn = "PhotoMail Links: On";
    var rte_i18n_PhotoMailLinksOff = "PhotoMail Links: Off";
    var rte_i18n_NoBordersAvailable = "No borders available.";
    var rte_i18n_Help = "Help";
    var rte_i18n_SaveInserted = "Save inserted photo to my Yahoo! Photos album:";
    var rte_i18n_PhotoMailPrefix = "PhotoMail Uploads ";
    var rte_i18n_PhotoMailDefAlbum = "PhotoMail Uploads";
    var rte_i18n_NewAlbum = "[New Album]";
    var rte_i18n_NewAlbumName = "New album name:";
    var rte_i18n_OptTextNoneHeader = "Best for printing";
    var rte_i18n_OptTextMedHeader  = "Faster but printable";
    var rte_i18n_OptTextHighHeader = "Fastest Sending";
    var rte_i18n_OptTextSize = "Est. total file size: ";
    var rte_i18n_OptTextTime = "Est. upload time: ";
    var rte_i18n_OptTimeUnit   = "sec";
    var rte_i18n_OptSizeUnit   = "k"; 
    var rte_i18n_OptTimeUnit2  = "min";
    var rte_i18n_OptSizeUnit2  = "MB"; 
    var rte_i18n_OptTextNA     = "N/A";		

    var rte_i18n_PTUserMsg = "To start using the Yahoo! Photo Tools you have to first insert photos.";
    var rte_i18n_PTUserMsg2 = "Get Started now!";
    

    var rte_i18n_DeleteThumbnailConfirmation = "Are you sure you want to delete this thumbnail?";
    var rte_i18n_DeleteAllThumbnailsConfirmation = "Are you sure you want to delete the selected thumbnails?";
    
	var rte_i18n_WrapperText1 = "The link you clicked on is not currently active. It is a preview of the message that the recipient will see.";

	var rte_i18n_WrapperText2 = "Slideshow | ";

	var rte_i18n_WrapperText3 = "Print at Home | ";

	var rte_i18n_WrapperText4 = "Order Prints | ";

	var rte_i18n_WrapperText5 = "Save to: My Yahoo! Photos or My Computer";
	var rte_i18n_WrapperText6 = "Click a photo to view a larger version on Yahoo! Photos. See links above for more options.";
	var rte_i18n_WrapperText7 = "The larger versions of these photos will be available until";
	var rte_i18n_WrapperText8 = "Share your pictures with PhotoMail from Yahoo! Mail. Learn more";
	var rte_i18n_WrapperText9 = "Go to Yahoo! Photos";
	var rte_i18n_WrapperText10 = "This PhotoMail contains images from Yahoo! Image Search. Click a photo to view a larger version.";


    var rte_i18n_WrapperImageBranding = "";

	var rte_i18n_ContextMenuItemText1 = "View";
	var rte_i18n_ContextMenuItemText2 = "Rotate";
	var rte_i18n_ContextMenuItemText3 = "Delete";
	var rte_i18n_ContextMenuItemText4 = "Properties";
	
	var rte_i18n_CutBlockedText = "You cannot copy thumbnails to the clipboard.";
	var rte_i18n_CopyBlockedText = "You cannot copy thumbnails to the clipboard.";

	var rte_i18n_EmptyCaptionText = "Click to add name";

	var RTE_EDITOR_PHOTOS_AKAMI_BASEPATH = "";
	
	// Array containing resources for the borders menu
	// 0 = Akami path
	// 1 = Label
	// 2 = Overlay image and xml file name
	// 3 = Overlay image size (in KB) 
	// 4 = Overlay image and xml file name for different orientation (optional)
	// 5 = Overlay image size (in KB) 
	
	var rtePhotoMailBorders = new Array(

		new Array("noborder", "No Border"),
		new Array("bba/blkthick66x47", "Black (thick)", "black1d2_l_180", 1),
		new Array("bba/blkthin66x47", "Black (thin)", "black1d4_l_180", 1),
		new Array("bba/whithick66x47", "White (thick)" , "white1d2_l_180", 1),
		new Array("bba/whithin66x47", "White (thin)" , "white1d4_l_180", 3),
		new Array("bba/greycorners", "Grey With Corners" , "GreyCorner_l_180", 17),
		new Array("bba/tancorner", "Tan With Corners" , "TanCorner_l_180", 17),
		new Array("bba/wood66x47", "Wood" , "wood2_l_180", 25),
		new Array("bba/western", "Western" , "western_l_180", 33),
		new Array("bba/glass66x47", "Glass" , "glass_l_180", 17),
		new Array("bba/filmedge1", "Film Edge 1" , "FilmEdge1_l_180", 20),
		new Array("bba/filmedge2", "Film Edge 2" , "FilmEdge2_l_180", 22),
		new Array("bba/brownstreaked", "Brown Streaked" , "BrownStreaked_l_180", 14),
		new Array("bba/blacktorn", "Black torn" , "BlackTorn_l_180", 4),
		new Array("be/rectw", "Fade to White" , "rectw_l_180", 3),
		new Array("be/ovallgw", "White Oval" , "ovallgw_l_180", 7),
		new Array("be/paintw", "White Paint" , "paintw_l_180", 7),
		new Array("bba/brushed", "Brushed" , "Brushed_l_180", 8),
		new Array("bba/canvas", "Canvas" , "Canvas_l_180", 8),
		new Array("bba/fabrique", "Fabrique" , "Fabrique_l_180", 9),
		new Array("bba/scribble", "Scribble" , "Scribble_l_180", 9),
		new Array("bba/singletorn", "Singletorn" , "SingleTorn_l_180", 3),
		new Array("bbi/newballoons", "Birthday Balloons" , "newballoons_l_180", 15, "newballoons_p_180", 16),
		new Array("bba/newarrivboy66x47", "New Arrival (Boy)" , "newarrivalboy_l_180", 15, "newarrivalboy_p_180", 17),
		new Array("bba/newarrivgirl66x47", "New Arrival (Girl)" , "newarrivalgirl_l_180", 15, "newarrivalgirl_p_180", 17)
	
	);
	

function focusStatWindow()
{
    if(!statWindow.closed)
     statWindow.focus();
}

function RTEEditorOnStationery(id)
{
    if (!RTEEditorValidateMode(id)) {
	    return;
    }

      
    RTEEditorHideAllDropDowns(id);
    var editor = rteEditorMap[id];
    var width = 392;
    var height = editor.location == "tw" ? 480 : 348;
    var left = (screen.availWidth - width) / 2;
    var top = (screen.availHeight - height) / 2;

    if (!editor.stationeryEnabled && !editor.seasonalStationery) {
       editor.stationeryWindow = window.open( 	 
           rte_i18n_StationerySplash,
           "LearnMore", 	 
           "width=450,height=750,scrollbars=yes,dependent=yes,resizable=yes"
	);
    }
    else if (!editor.stationeryEnabled && editor.seasonalStationery) {
	editor.stationeryWindow = window.open(
	    "/ym/Stationery?.rand=" + Math.random() + "&free=1", 
	    "stationery", 
	    "left=" + left 
	    + 
	    ",top=" + top 
	    + 
	    ",width=" + width 
	    + 
	    ",height=" + height
	);
    }
    else {
	editor.stationeryWindow = window.open(
	    "/ym/Stationery?.rand=" + Math.random(),
	    "stationery", 
	    "left=" + left 
	    + 
	    ",top=" + top 
	    + 
	    ",width=" + width 
	    + 
	    ",height=" + height
	);
    }

    if (editor && typeof editor.stationeryWindow != "undefined") {
      statWindow = editor.stationeryWindow;
      window.setTimeout("focusStatWindow()", 100);
    }
}

			    var idGenerator = new RTEIDGenerator(0);



			var remote=null;
			var sigAttMap = [false];

			function OnFromAddrChange()
			{
				var i = document.Compose.FromAddr.selectedIndex;
				if (i >= 0 && i < sigAttMap.length) document.all.SA.checked = sigAttMap[i];
			}

			function rs(n,u,w,h,x)
			{
				args="width="+w+",height="+h+",resizable=yes,scrollbars=yes,status=0";
				if (typeof u.indexOf != "undefined") {
					if (u.indexOf("%26") > -1) {
						u += "%26cachebuster=" + Math.random();
					} else {
						u += "%3Fcachebuster=" + Math.random();
					}
				}
				remote=window.open(u,n,args);
				if(remote != null && remote.opener == null) remote.opener = self;
				if(x == 1) return remote;
			}

			function setFormat()
			{
			   if(document.Compose.Format.checked) document.Compose.Format.value="html";
			   else document.Compose.Format.value="plain";
			}

	  	    function GetStartedNow()
		    {
			document.Compose.PhotoGetStart.value = "1";
			AttachFiles('1');
	 	    }

		    function GetFlashVersion()
		    {
			    var version = 0;
			    for(var i=6; i<=10; i++)
			    {
				    try
				    {
					    var obj = new ActiveXObject("ShockwaveFlash.ShockwaveFlash." + i);
					    version = i;
					    break;
				    }
				    catch(e){ }
			    }
			return version;	
		    }

		    function showPhotoMailTutorial(flow)
		    {
			var tutorialURL = "http://photomail.mail.yahoo.com/quicktour";
			var introtitle = "";
			if(flow == "InstallSuccess")
			{
		  	    tutorialURL += "?InstallSuccess";
			    introtitle = "Welcome to the Yahoo! Mail Quick Select Tool with PhotoMail";
			}
			else if(flow == "NewUser")
			{
			    tutorialURL += "?NewUser";
			    introtitle = "WELCOME: NEW TO PHOTOMAIL";	
			}
			else if(flow == "GetStarted")
			{
			    tutorialURL += "?GetStarted"; 	
			    introtitle = "WELCOME: GET STARTED NOW";
			}

			var browse = document.all.browse;	
                        browse.SetParam( "introurl", tutorialURL);
                        browse.SetParam( "introtitle", introtitle);
                        browse.SetParam( "introh", "420" );
                        browse.SetParam( "introw", "725" );
                        browse.Intro(); 	
	 	    }

		    function SetUserPhotoKey()
		    {
			var sURI = "ym";
			var sURLExtras = "YY=86217&order=down&sort=date&pos=0";
			var content = "<script"+">parent.refreshInstaCompose();<"+"/script>"
			window.open("/"+sURI+"/Asynch?op=setphotokey&content="+content+"&"+sURLExtras,"asynch");
		    }
			
		    function refreshInstaCompose()
		    {       
			if(self.name == "ymailmain")
			   parent.refreshCompose();
		    }

	 	    function ShowPhotoMailWelcome()
	 	    {
			if(GetFlashVersion() == 0) return;
				
			if(document.Compose.PhotoToolInstall.value == "1")
			{
			    showPhotoMailTutorial("InstallSuccess")
			    document.Compose.PhotoToolInstall.value = "0";
			}
			else if(document.Compose.PhotoMailUser.value == "0")
			{
		 	    showPhotoMailTutorial("NewUser")	
			}
			else if(document.Compose.PhotoGetStart.value == "1")
			{
		 	    showPhotoMailTutorial("GetStarted")	
		 	    document.Compose.PhotoGetStart.value = "0";
			}

			if(document.Compose.PhotoMailUser.value == "0")
			{
			    SetUserPhotoKey();
			    document.Compose.PhotoMailUser.value = "1";		
			}	
		    }	

            function VersionChecker(p_sElementId, p_bDOM)
            {
                if(p_sElementId && p_sElementId.length > 0)
                {
                    this.Id = p_sElementId;
            
                    var m_oVersionChecker = null;
            
                    if(p_bDOM)
                    {
                        m_oVersionChecker = document.createElement("object");
                        m_oVersionChecker.id = this.id;
                        m_oVersionChecker.classid = "CLSID:D5184A39-CBDF-4A4F-AC1A-7A45A852C883";
                        m_oVersionChecker.style.display = "none";
                        
                        document.body.appendChild(m_oVersionChecker);
                    }
                    else
                    {
                        this.HTML = "<OBJECT width=\"0\" height=\"0\" ID=\"" + this.Id + "\" CLASSID=\"CLSID:D5184A39-CBDF-4A4F-AC1A-7A45A852C883\"></OBJECT>";
                        document.write(this.HTML);
                        m_oVersionChecker = document.getElementById(this.Id);                    
                    }            
            
			function GetControlVersion(p_sControlId) {
            
			var sVersion = "0";

                        try
                        {
                            sVersion = m_oVersionChecker.fv(p_sControlId);
                            if(sVersion.length == 0) sVersion = "0";
                        }
                        catch(oException) {}
            
                        return sVersion;
                    };
            
                    this.GetBrowseVersion = function() {
                          
                         return GetControlVersion("YMailBrowse.YahooBrowse.1");
            
                    };
                
                    this.GetComposeVersion = function() {
                          
                         return GetControlVersion("YMailCompose.Compose.1");
            
                    };                
            
                }
            }


            function UpgradeSelectorControl()
            {
                if(g_sBrowseVersion != "0")
                {
                    if(!g_bGoodBrowse)
                    {
                        var sURI = "ym";
                        var bAction = window.showModalDialog("/"+sURI+"/Static?file=PhotoMailUpgrade.html",null,"dialogHeight:150px;dialogWidth:500px;status:no;help:no;resizable:no;scroll:no;");
                        
                        if(bAction)
                        {
            				SetVals();
            				document.Compose.action = "";
            				document.Compose.submit();
                        }

                        return true;
                    }
                    else return;
                }
                else return;
            }

            function AttachFiles_Default()
            {
					SetVals();
				document.Compose.ATT.value = "1";
				document.Compose.submit();
            }

            function AttachFiles_PhotoMail()
            {
                AttachFiles('0');            
            }

			function AttachFiles(startmypic)
			{
			    var pmw = document.Compose.PhotoMailWith;
			    if (startmypic == "1") {
				if (pmw.value == "") {
				    pmw.value = "I";
				}
				else if (pmw.value == "A") {
				    pmw.value = "B";
				}
			    }
			    else {
				if (pmw.value == "") {
				    pmw.value = "A";
				}
				else if (pmw.value == "I") {
				    pmw.value = "B";
				}
			    }
                if(startmypic == "1" && UpgradeSelectorControl()) return;
				var succ = AttachFilesUsingControl(startmypic)
			    if(succ) return;	
			

				document.Compose.ATT.value = "1";
				document.Compose.submit();
			
			}

			function AttachFilesUsingControl(startmypic, mode)
		    {
				if(g_bGoodBrowse)
				{
					ShowPhotoMailWelcome();
					Reorder();
				
					var browse = document.all.browse;
				
					if(typeof mode != "undefined")
					{
					    browse.SetParam("attachinsert", 'n');
					    browse.SetParam("startmypic", '0');
					}
					else
					    browse.SetParam("startmypic", startmypic);
						
					if(typeof mode != "undefined")
					    browse.SetParam("handlephotos", mode == 'I' ? 'y' : 'n');
	
					var fi = browse.Browse();

					if(fi == null) {
					    return true;
					}

					var fileInfo = ParseFileInfo(fi);

					ClearAttachments();
					CheckThumbnails(fileInfo);
				 	UpdateComposeWithAttachment(fileInfo);	
					
					return true;
				}
			
				SetVals();
				document.Compose.PhotoMailInstallOrigin.value = "I";
				var succ = InstallPhotoMailControl(startmypic);
				return succ;
			}
	
			function LearnMorePhotoMailControl(startmypic, extras) {
				SetVals();
				document.Compose.PhotoMailInstallOrigin.value = "L";
				var succ = InstallPhotoMailControl(startmypic, extras);
				return succ;
			}
					  
			function InstallPhotoMailControl(startmypic, extras)
			{
			    if(startmypic == "1")
			    {
				    document.Compose.action = "";
				    if (typeof extras != "undefined")
					document.Compose.action += extras;
				    document.Compose.target="_top";
				    document.Compose.submit();
				    return true;
			    }
			    return false;	
			}
		
			function UpdateComposeWithAttachment(fileInfo)
			{
				var n = fileInfo.length;
				if(n)
				{
					for(var i=0; i<n; i++)
					{
						if(fileInfo[i].share == "A")
						{
							AddAttachment(
								fileInfo[i].path,
								fileInfo[i].caption,
								fileInfo[i].size
							);
						}
						else
						{
							if(!FindThumbnail(fileInfo[i].path))
							{
								var marker = GenMarker();
			
								if(!aPhotosToInsert) aPhotosToInsert = new Array();
							
								// Cache the file info to insert later
								aPhotosToInsert.push(
									new Array(
										fileInfo[i].thumbnail,
										fileInfo[i].path, 
										fileInfo[i].caption, 
										"marker" + marker,
										fileInfo[i].origin
									)
								);

							}
						}
					} // end loop
					
					UpdateEditorAndThumbnailMgr();
					
				}
				UpdateAttachmentDisplay();

			}

			function UpdateEditorAndThumbnailMgr() 
			{
				if(aPhotosToInsert)
				{
					var aPhotoInfo = null;
					var nTotalPhotos = aPhotosToInsert.length-1;
					
					for(var i=0; i<aPhotosToInsert.length; i++)
					{
						aPhotoInfo = aPhotosToInsert[i];
						
						editor.InsertThumbnail(
							aPhotoInfo[0], // Path to the thumbnail
							aPhotoInfo[1], // Real path
							aPhotoInfo[2], // Caption
							aPhotoInfo[3], // Marker
							aPhotoInfo[4], // Local file ?
							i,				// Current file number
							nTotalPhotos	// Total files to insert
						);
						
						AddThumbnail(aPhotoInfo[1], aPhotoInfo[3].substring(6));
					}
					
					// Clean up global
					aPhotosToInsert = null;
				}

			}

			function RemoveAttachment(index)
			{
					SetVals();
					if (g_bGoodBrowse) {
					    SaveBrowseState();
					}
				document.Compose.action += "&UNATTACH=File" + index;
				document.Compose.submit();
			}

			function initializeAutocomplete(i)
			{
				if(self.name == "ymailcompose")
					return;	

				if( typeof AC_OnLoad == 'function' && typeof AC_allCanons == 'object' )
				{
					AC_OnLoad();
					return;
				}

				i *= 2;
			        setTimeout('initializeAutocomplete(' + i + ');', i);
			}

			function loadAutocomplete()
			{
				if(self.name == "ymailcompose")
					return;	

				var el = document.createElement( "script" );
				el.setAttribute( "type", "text/javascript" );
				el.setAttribute( "src", "http://address.mail.yahoo.com/acjs3/us/Q4OIaT0e3kQHx4Y7TcD3_A--");
				document.getElementsByTagName( "head" )[ 0 ].appendChild( el );	
				setTimeout('initializeAutocomplete(10);', 1);
			}

			function asyncSendSpaceId()
			{
				if( self.name == "ymailmain" )
					setTimeout("sendSpaceId();", 10);
			}

			function sendSpaceId()
			{
				var mills = new Date();
				var spaceIter = mills.getTime();
				var spaceIter2 ="";
				var ea = "delhi_kapil@yahoo.com".split("@",1)[0];
				var spaceid = 150500005;
				var intl = "us";
				var prop = intl + "mail";

				switch(intl)
				{
					case 'fr': spaceid += 1000; break
					case 'de': spaceid += 2000; break
					case 'it': spaceid += 3000; break
					case 'se': spaceid += 4000; break
					case 'dk': spaceid += 5000; break
					case 'no': spaceid += 6000; break
					case 'es': spaceid += 7000; break
					case 'uk': spaceid += 8000; break
					case 'au': spaceid += 9000; break
					case 'b5': spaceid += 10000; break
					case 'br': spaceid += 11000; break
					case 'ca': spaceid += 12000; break
					case 'e1': spaceid += 13000; break
					case 'cn': spaceid += 14000; break
					case 'hk': spaceid += 15000; break
					case 'jp': spaceid += 16000; break
					case 'kr': spaceid += 17000; break
					case 'sg': spaceid += 18000; break
					case 'tw': spaceid += 19000; break
					case 'aa': spaceid += 20000; break
					case 'h1': spaceid += 21000; break
					case 'mx': spaceid += 22000; break
					case 'ar': spaceid += 24000; break
					case 'in': spaceid += 27000; break
					case 'cf': spaceid += 28000; break
					case 'gr': spaceid += 31000; break
					case 'k1': spaceid += 32000; break
					case 'ct': spaceid += 33000; break
					case 'ru': spaceid += 34000; break
				}

				for (var i=0; i < ea.length; i++)
    				spaceIter2 += ea.charCodeAt(i).toString(16);

				if(typeof spaceidframe == 'undefined')
					var spaceidframe = frames["spaceidframe"];
 
	
			}

			var gReplyForward = null;
			function initializeInstacompose()
			{
				var useIC = (self.name == "ymailmain");

				if((self.name == "ymailmain" && parent.getReplyForwardKind() != "") || useIC)
				{
				    asyncSendSpaceId();
					
					gReplyForward = parent.getReplyForwardKind();
					if( parent.getReplyForwardKind() != "" )
					{
						parent.setReplyForwardKind("");
						parent.setReplyForwardTo("");

						document.Compose.subjectfield.value 
							= parent.getReplyForwardTitle();
						parent.setReplyForwardTitle("");

						document.Compose.Body.value 
							= parent.getReplyForwardBody();
						parent.setReplyForwardBody("");

						document.Compose.ccfield.value 
							= parent.getReplyForwardCc();

						if (document.Compose.ccfield.value != "") {
						    UpdateFieldHeight ( document.Compose.ccfield );
						    DisplayElement ( "ccrow", "block" );
						    DisplayElement ( "cclink", "none" );
						    DisplayElement ( "cclink2", "inline" );
						}
						parent.setReplyForwardCc("");

						if( document.Compose.PlainMsg )
							document.Compose.PlainMsg.value 
								= document.Compose.Body.value; 
						var urlExtras = parent.getReplyForwardUrlExtras();
						if(urlExtras)
						{
						    document.Compose.action 
								= document.Compose.action +"&"+ urlExtras;
						    parent.setReplyForwardUrlExtras("");
						}

						var regex = new RegExp("mid=([\\d_]+)");
						var lowerCaseUrlExtras = urlExtras.toLocaleLowerCase();
						var match = lowerCaseUrlExtras.match(regex);
						var MsgId;
						if (match[1]) {
							MsgId = match[1];
						} else {
							MsgId = "";
						}

						if( gReplyForward == "Reply")
						{
							if( typeof editor != "undefined" && editor )
								editor.Focus();
							else
							{
								if(!document.all)
								{
									document.Compose.Body.selectionStart = 0;
									document.Compose.Body.selectionEnd = 0;
								}
						
								document.Compose.Body.focus();
							}

							document.Compose.InReplyTo.value = MsgId;
							
						} else {
                                                        document.Compose.FwdSubj.value = MsgId;
						}

 

					}
				}
			}
	
				function Switch(params)
				{
						// FIX ME - we should only call GetText() once...
						if(editor.GetText() != "" && editor.GetText() != editor.GetHTML()) 
						{
							var conf = confirm("This will convert your message into plain text.  All formatting will be lost.  Continue?");
							if(!conf) return; 
						}
				
						document.Compose.Body.value = editor.GetHTML();

               		if (g_bGoodBrowse) {
                    	    SaveBrowseState();     
                    	    SaveAttachments();      
                	}       

					params = typeof params == "undefined" ? "" : params; 

					document.Compose.action = document.Compose.action + "&SWITCH=1" + params;
					document.Compose.submit();
				}

				function KeyPress()
				{
				    if (event.keyCode == 13) {
					Send_Click();
				    }
				}



				function CreateBrowseControlHTML()
				{
					var sBrowseControl = "<object id=\"browse\" width=0 height=0 classid=\"CLSID:0B2D666F-9EDA-4C1E-8C3B-A061AAB0615C\">";
					
					function AddParam(p_sName, p_sValue) {
						
						var sParam = "<param name=\"" + p_sName + "\" value=\"" + p_sValue + "\">";

						sBrowseControl += sParam;

					};

					sBrowseControl += "</object>";alert("satish :"+sBrowseControl);
				
					return sBrowseControl;

				}

				function GoodBrowse()
				{
					return g_bGoodBrowse;
				}

				function CheckIfBrowseControlIsInstalled()
				{
					var bSelectorInstalled = false;
					
					try
					{
						var oBrowse = new ActiveXObject("YMailBrowse.YahooBrowse.1");
						bSelectorInstalled = (oBrowse && oBrowse.ComponentVersionNbr && oBrowse.ComponentVersionNbr >= "2005081901");
						oBrowse = null;
					}
					catch(e)
					{
						return false;
					}
					
					return bSelectorInstalled;
				}


				var thumbnails = new Array();
				var attachments = new Array();
				var uploadFileInfo = null;
				var restoreThumbnails = false;
				var uploading = false;
				var uploadCancelled = false;

				function Reorder()
				{
				    var browse = document.all.browse;
				    var idx = 0;
				    for (
					var i = 0;
					i < attachments.length;
					i++
				    ) {
					browse.Reorder(
					    idx, attachments[i].path
					);
					idx++;
				    }
				    if(typeof editor != "undefined")
				    {	
					var paths = editor.GetThumbnails();
					for (
					    var i = 0;
					    i < paths.length;
					    i++
					) {
					    browse.Reorder(
						idx, paths[i]
					    );
					    idx++;
					}
				    }
				}

				function SyncCaptions()
				{
					var aThumbnails = editor.GetThumbnailCaptions();
					var i = aThumbnails.length - 1;
					var oBrowse = document.getElementById("browse");
					
					if(oBrowse)
					{
						do oBrowse.UpdateCaption(aThumbnails[i][0], aThumbnails[i][1]);
						while(i--);
					}
					
					oDocument = null;
				}				
				
				function AddAttachment(path, name, size)
				{
				    attachments[attachments.length] = {
					path: path,
					name: name,
					size: size
				    };
				}

				function ClearAttachments()
				{
				    attachments.length = 0;
				}

				function UpdateAttachmentDisplay()
				{
					var oDIV = document.getElementById("attdisplay");
					
					if(oDIV)
					{
						var aExistingAttachments = oDIV.getElementsByTagName("nobr");
						var oLastExistingAttachment = null;
						
						if(aExistingAttachments && aExistingAttachments.length > 0)
						{
							var nIndex = aExistingAttachments.length - 1;
							var oLastExistingAttachment = aExistingAttachments[nIndex];
								
							// If we are going to be adding more to the current list 
							// then append a comma to the last, existing attachment
							if(attachments.length > 0) oLastExistingAttachment.innerHTML += ",";
						}
					
						var html = "";
						
						for(var i=0; i<attachments.length; i++)
						{
							html += '<nobr><img src="http://us.i1.yimg.com/us.yimg.com/i/us/pim/clip_1.gif" .Att_Width .Att_Height border=0 align=top> <b>';
							html += attachments[i].name;
							html += '</b> (';
							html += attachments[i].size;
							html += 'k) [<a href="#" onclick="DeleteAttachment(' + i + ')">Remove</a>]';
							if((i+1) < attachments.length) html += ", ";
							html += '</nobr>';
						}
						
						oDIV.getElementsByTagName("span")[0].innerHTML = html;
						
						aExistingAttachments = oDIV.getElementsByTagName("nobr");
						
						if(aExistingAttachments.length == 1)
						{
							oLastExistingAttachment = aExistingAttachments[0];
						
							var sFileName = oLastExistingAttachment.innerHTML;

							sLastChar = sFileName.substring((sFileName.length-1),sFileName.length);
							
							// Remove the comma since we are not adding more								
							if(sLastChar == ",") oLastExistingAttachment.innerHTML = sFileName.substring(0,(sFileName.length-1));
						}
					}
				}

				function DeleteAttachment(i)
				{
				    document.all.browse.RemoveSelectedFile(attachments[i].path);
				    attachments = attachments.slice(
					0, i 
				    ).concat(
					attachments.slice(
					    i + 1
					)
				    );
				    UpdateAttachmentDisplay();
				}

				function SaveAttachments()
				{
				    var s = "";
				    for (
					var i = 0; 
					i < attachments.length; 
					i++
				    ) {
					if (s != "") {
					    s += "|";
					}
					s += attachments[i].name + "*" + attachments[i].size;
				    }
				    document.Compose.Attachments.value = s;
				}

				function AddThumbnail(path, marker)
				{
					thumbnails[thumbnails.length] = {
					path: path,
					marker: marker
				    };
				}

				function RemoveThumbnail(marker)
				{
					for(var i=0; i<thumbnails.length; i++)
					{
						if("marker" + thumbnails[i].marker == marker)
						{
							thumbnails = thumbnails.slice(0, i).concat(thumbnails.slice(i + 1));
							return;
						}
					}
				}

				function FindThumbnail(path)
				{
				    var n = thumbnails.length;
				    for (var i = 0; i < n; i++) {
					if (thumbnails[i].path == path) {
					    return thumbnails[i];
					}
				    }
				    return null;
				}

				function SaveThumbnails()
				{
				    var s = "";
				    for (
					var i = 0; 
					i < thumbnails.length; 
					i++
				    ) {
					if (s != "") {
					    s += "|";
					}
					s += thumbnails[i].path + "*" + thumbnails[i].marker;
				    }
				    document.Compose.Thumbnails.value = s;
				}

				function RestoreThumbnails()
				{
				    var s = document.Compose.Thumbnails.value.split("|");
				    ClearThumbnails();
				    for (var i = 0; i < s.length; i++) {
					var f = s[i].split("*");
					if (f.length >= 2) {
					    AddThumbnail(f[0], f[1]);
					}
				    }
				    
				}

				function CheckThumbnails(fileInfo)
				{
				    for (
					var i = 0;
					i < thumbnails.length;
					i++
				    ) {
					for (
					    var j = 0;
					    j < fileInfo.length
					    &&
					    !(
						fileInfo[j].share == "I"
						&&
						fileInfo[j].path == thumbnails[i].path
					    );
					    j++
					);
					if (j >= fileInfo.length) {
					    editor.DeleteThumbnail(
						thumbnails[i].path
					    );
					    thumbnails = thumbnails.slice(0, i).concat(thumbnails.slice(i + 1));
					    i--;
					}
				    }
				}

				function ClearThumbnails()
				{
				    thumbnails.length = 0;
				}

				function GetThumbnailPaths()
				{
				    var paths = new Array();
				    for (
					var i = 0; 
					i < thumbnails.length; 
					i++
				    ) {
					paths[i] = thumbnails[i].path;
				    }
				    return paths;
				}
				
				function SaveBrowseState()
				{
					if(typeof g_bBrowseStateSaved == 'undefined' || !g_bBrowseStateSaved)
					{
					    if(thumbnails.length || attachments.length) 
						{
							SaveThumbnails();
							document.Compose.BrowseState.value = document.all.browse.Save();
							document.Compose.ToolbarState.value = GetToolbarState();
							g_bBrowseStateSaved = true;		
					    }						
					}
				}

				function GetToolbarState()
				{
					var styInfo = editor.GetToolbarState();
					var expanded = editor.IsPhotoToolbarExpanded();
					var caption = styInfo.caption;
					caption = caption.replace(/\'/,"\\\'")	
					caption = caption.replace(/\"/,"\\\"")	
					var state = "{save:"+styInfo.save+",path:'"+styInfo.path
					state += "',expanded:"+expanded+",optimize:"+styInfo.optimize
					state += ",layout:"+styInfo.layout+",si:"+styInfo.si 
					state += ",isNew:"+ styInfo.isNew+",caption:'"+caption+"'}";
					return state;
				}

				function RestoreBrowseState()
				{
				    if (document.Compose.BrowseState.value != "") {
					document.all.browse.Restore(
					    document.Compose.BrowseState.value
					);
					document.all.browse.SetParam("AttData", document.Compose.AttData.value);
					document.all.browse.SetParam("UplData", document.Compose.UplData.value);					
					document.Compose.BrowseState.value = "";
					RestoreThumbnails();
					RestoreToolbarState()
					editor.RestoreThumbnails();

					var fi = document.all.browse.FileInfo("");
					var fileInfo = ParseFileInfo(fi);
					if (fileInfo && fileInfo.length) {
					    ClearAttachments();
					    for (
						var i = 0; 
						i < fileInfo.length;
						i++
					    ) {
						if (fileInfo[i].share == "A") {
						    AddAttachment(
							fileInfo[i].path,
							fileInfo[i].caption, 
							fileInfo[i].size
						    );
						}
					    }
					    UpdateAttachmentDisplay();
					}
				    }
				}

				function RestoreToolbarState()
				{
					if (document.Compose.ToolbarState.value != "") {
					    var state = document.Compose.ToolbarState.value;
					    try {
					        eval("state="+state);
					    }
					    catch(err) { 
						state=null; 
				  	    }		
					    if(state)	
					        editor.RestoreToolbarState(state);
					    document.Compose.ToolbarState.value = "";	
					}
				}

				function LinkClicked(url)
				{
				    var helpLink = editor.OpenWindow(url,'_Help','width=625,height=600,left=100,top=40,scrollbars=yes,resizable=yes',false);	
				    if(helpLink && !helpLink.closed)
					helpLink.focus();
				}

				function UploadProgress(pct)
				{
				    if (pct < 0) {
					pct = 0;
				    }
				    else if (pct > 100) {
					pct = 100;
				    }
                    document.getElementById("photomailuploadprogress").getElementsByTagName("span")[0].style.width = pct + "%";
				}

				function UploadStep(idx, name, step)
				{
				    var msg = "";
				    if (name != "") {
					msg += "<em>Uploading: </em>";
					msg += name;
					if (
					    uploadFileInfo 
					    && 
					    uploadFileInfo.length
					    &&
					    1 <= idx 
					    && 
					    idx <= uploadFileInfo.length
					) {
					    msg += " (";
					    msg += idx;
					    msg += " of ";
					    msg += uploadFileInfo.length;
					    msg += ")";
					}
				    }
				    if (msg != "") {
                    document.getElementById("photomailuploadprogress").getElementsByTagName("div")[0].innerHTML = msg;
				    }

				}

				function TransferStatus(x, r)
				{
				    msg = "";
				    if (r.length == 6) {
					var h = parseInt(r.substring(0, 2), 10);
					var m = parseInt(r.substring(2, 4), 10);
					var s = parseInt(r.substring(4, 6), 10);
					if (h) {
					    msg += h;
					    if (h == 1) {
						msg += " hour";
					    }
					    else {
						msg += " hours ";
					    }
					}
					if (m) {
					    msg += m;
					    if (m == 1) {
						msg += " minute ";
					    }
					    else {
						msg += " minutes ";
					    }
					}
					if (s) {
					    msg += s;
					    if (s == 1) {
						msg += " second";
					    }
					    else {
						msg += " seconds";
					    }
					}
				    }
				    if (msg != "") {
					msg = "Estimated time remaining: " + msg;
					document.getElementById("photomailuploadprogress").getElementsByTagName("div")[2].innerHTML = msg;
				    }
				}

				function CancelUpload()
				{
				    uploadCancelled = true;
				    document.all.browse.Cancel();
				    HideSending();
					RestoreBrowseState();
				}

				function GenMarker()
				{
				    return document.Compose.NextMarker.value++;
				}

				function AddMarker(marker, name, path, origin, caption)
				{
				    if (origin == "S") {
					caption += " [Image Search]";
				    }
				    var s = document.Compose.Markers.value;
				    if (s != "") {
					s += "\01";
				    }
				    s += marker + "\02" + name + "\02" + path + "\02" + origin + "\02" + caption;
				    document.Compose.Markers.value = s;
				}

				function FindCaption(captions, path)
				{
				    for (var i = 0; i < captions.length; i++) {
					if (captions[i][0] == path) {
					    return captions[i][1];
					}
				    }
				    return "";
				}

				function ShowSendError(error)
				{
				    var errors = {
					NumFiles: "You have exceeded the maximum allowed number of attachments",
					FileSize: "A file you are trying to attach is too big.",
					TotalSize: "You have exceeded the total attachment size.",
					Already: "A file you are trying to attach is already attached.",
					BadFile: "Invalid file specified. Please try again.",
					NoFile: "No file specified. Please try again.",
					NoUpload: "There was a temporary problem uploading a file. Please try again in a few minutes.",
															NoTo: "Please enter at least one addressee in the <em>To</em> field.<br>Your message has <em>not</em> been sent.",
					Internal: "We encountered an internal error. Please try again in a few minutes.",
															ph34: "One or more photos you selected from Yahoo! Photos was not available. Please edit your selection.",
															ph62: "You have reached the storage limit on your account. Please edit your account to free up more space."
				    };
				    var photosError = false;
				    if (error.substring(0, 7) == "RESULT=") {
					photosError = true;
					error = "ph" + parseInt(
					    error.substring(7)
					);
				    }
				    var message = errors[error];
				    if (typeof message == "undefined") {
					message = photosError ?
                                            ""
					    :
					    "";
				    }
				    document.all.clientprobdesc.innerHTML = message;
				    if (typeof document.all.serverprobdisplay != "undefined") {
					document.all.serverprobdisplay.style.display = "none";
				    }
				    document.all.clientprobdisplay.style.display = "inline";
				    document.all.sending.style.display = "none";
				    document.all.stuff.style.display = "inline";
				}

				function LogSendError(msg)
				{
				    msg = "photomail send error; " + msg;
				    window.open(
					"/ym/Asynch?op=log&msg=" 
					+
					escape(msg)
					+
					"&YY=86217&order=down&sort=date&pos=0",
					"asynch"
				    );
				}

				function HideSendError()
				{
				    document.all.clientprobdisplay.style.display = "none";
				}

				function UploadComplete(attempted, successful)
				{
				    if (uploadCancelled) {
					return;
				    }
				    var browse = document.all.browse;
				    var error = browse.GetError();
				    if (error != "") {
					ShowSendError(error);
					return;
				    }
				    document.getElementById("photomailuploadprogress").getElementsByTagName("span")[0].style.width = "100%";
				    document.Compose.Markers.value = "";
				    var fileInfo = uploadFileInfo;
				    if (fileInfo && fileInfo.length) {
					var captions = [];
					if(thumbnails.length > 0) {
					    captions = editor.GetThumbnailCaptions();
					}

					var numMarkers = 0;
					for (
					    var i = 0; 
					    i < fileInfo.length; 
					    i++
					) {
					    if (fileInfo[i].share == "I") {
						var rs = browse.GetResponse(
						    fileInfo[i].path, "M"
						);
						var data = ParseAttachmentResponse(
						    rs,
						    fileInfo[i].share
						);
						var name = GetLastUpload(data);
						if (name == "") {
						    ShowSendError("Internal");
						    rs = rs.replace(/</g, "[");
						    rs = rs.replace(/>/g, "]");
						    LogSendError(
							"name is blank; rs: "
							+
							rs
						    );
						    RestoreBrowseState();
						    return;
						}
						var thumbnail = FindThumbnail(fileInfo[i].path);
						if (!thumbnail) {
						    ShowSendError("Internal");
						    LogSendError(
							"thumbnail not found; "
							+
							"looking for: "
							+
							fileInfo[i].path
							+
							" among: "
							+
							GetThumbnailPaths()
						    );
						    RestoreBrowseState();
						    return;
						}
						var path = fileInfo[i].origin == "S" ? fileInfo[i].location : (browse.GetParam("DETAIL_URL") + "?" + browse.GetPhotosPath(fileInfo[i].path));

						var caption = FindCaption(captions, fileInfo[i].path);
						AddMarker(
						    thumbnail.marker,
						    name,
						    path,
						    fileInfo[i].origin,
						    caption
						);
						numMarkers++;
					    }
					}
					if (numMarkers != thumbnails.length) {
					    ShowSendError("Internal");
					    LogSendError(
						"missing markers; markers: "
						+
						numMarkers
						+
						" thumbnails: "
						+
						thumbnails.length
					    );
					    RestoreBrowseState();
					    return;
					}
					document.Compose.AttData.value = browse.GetParam("AttData");
					document.Compose.UplData.value = browse.GetParam("UplData");
					var dir = browse.GetParam(".dir");
 
					document.Compose.PhotoPrintAtHomeLink.value = browse.GetParam("PRINTATHOME_URL");
					document.Compose.PhotoSlideShowLink.value = browse.GetParam("SLIDESHOW_URL");
					document.Compose.PhotoPrintLink.value = browse.GetParam("PRINT_URL");
					document.Compose.PhotoSaveLink.value = browse.GetParam("LIST_URL");
					document.Compose.PhotoPermCap.value = browse.GetParam("phpermcap");
					document.Compose.PhotoPermPath.value = browse.GetParam("LIST_URL");
					document.Compose.PhotoDownloadUrl.value = browse.GetParam("DOWNLOAD_URL");
					document.Compose.PhotoSaveUrl.value = browse.GetParam("SAVE_URL");
					document.Compose.PhotoFlags.value = editor.GetPhotoMailFlags();
					editor.PrepareThumbnailsForSend();
				    }

				    document.Compose.VirusReport.value = "1";
				    uploading = false;
				    Send();
				}

				function ParseFileInfo(fi)
				{
					var fileInfo = new Array();
					var entries = fi.split("\01");
					var n = entries.length;
				
					for(var i=0; i<n; i++)
					{
						var fields = entries[i].split("\02");
					
						if(fields.length < 9) continue;
						
						fileInfo[fileInfo.length] = {
							path : fields[0],
							caption: document.all.browse.GetCaption(fields[0]),
							size: fields[3],
							share: fields[7],
							origin: fields[6],
							location: fields[8],
							thumbnail: fields[11],
							ePath: fields[1]  //edited path
						};
					}
					
					return fileInfo;
				}

				function ParseAttachmentResponse(rs, share)
				{
				    var beginTag, endTag;
				    if (share == "A") {
					beginTag = "<attdata>";
					endTag = "</attdata>";
				    }
				    else {
					beginTag = "<upldata>";
					endTag = "</upldata>";
				    }
				    var begin = rs.indexOf(beginTag);
				    if (begin == -1) {
					return "";
				    }
				    begin += 9;
				    var end = rs.indexOf(endTag, begin);
				    if (end == -1) {
					return "";
				    }
				    return rs.substring(begin, end);
				}

				function GetLastUpload(data)
				{
				    var i = data.lastIndexOf("*DMAF*");
				    if (i != -1) {
					data = data.substring(i + 6);
				    }
				    i = data.indexOf("*DMAI*");
				    if (i == -1) {
					return "";
				    }
				    return data.substring(0, i)
				}

				function ThumbnailDeleted(path, marker)
				{
				    document.all.browse.RemoveSelectedFile(path);
				    RemoveThumbnail(marker);
				}

				var aPhotosToInsert = null;
				
				function FileDropped(path, size, currentfile, totalfiles)
				{
					if(!document.all.browse.IsSelected(path)) document.all.browse.SelectFile(path);
					else return;

					if(IsJPEG(path))
					{
						var marker = GenMarker();

						if(!aPhotosToInsert) aPhotosToInsert = new Array();
						var sFileInfo = document.all.browse.FileInfo(path);
						var aFileInfo = ParseFileInfo(sFileInfo);
						
						// Cache the file info to insert later
						aPhotosToInsert.push(
							new Array(
								aFileInfo[0].thumbnail,
								aFileInfo[0].path, 
								aFileInfo[0].caption, 
								"marker" + marker,
								aFileInfo[0].origin
							)
						);
					}
					else
					{
						var fi = document.all.browse.FileInfo("");
						var fileInfo = ParseFileInfo(fi);

						if(fileInfo && fileInfo.length)
						{
							ClearAttachments();
							
							for(var i=0; i < fileInfo.length; i++)
							{
								if(fileInfo[i].share == "A")
								{
									AddAttachment(
										fileInfo[i].path,
										fileInfo[i].caption, 
										fileInfo[i].size
									);
								}
							}
							
							UpdateAttachmentDisplay();
						}
					}
					
					if(aPhotosToInsert && currentfile == totalfiles)
					{
						var aPhotoInfo = null;
						var nTotalPhotos = aPhotosToInsert.length-1;
						
						for(var i=0; i<aPhotosToInsert.length; i++)
						{
							aPhotoInfo = aPhotosToInsert[i];
							
							editor.InsertThumbnail(
								aPhotoInfo[0], // Path to the thumbnail
								aPhotoInfo[1], // Real path
								aPhotoInfo[2], // Caption
								aPhotoInfo[3], // Marker
								aPhotoInfo[4], // Local file ?
								i,				// Current file number
								nTotalPhotos	// Total files to insert
							);
							
							AddThumbnail(aPhotoInfo[1], aPhotoInfo[3].substring(6));
						}
						
						// Clean up global
						aPhotosToInsert = null;
					}
				}

				function IsJPEG(path)
				{
				    var dot = path.lastIndexOf(".");
				    if (dot == -1) {
					return false;
				    }
				    var ext = path.substring(dot + 1).toLowerCase();
				    return ext == "jpg" || ext == "jpeg" || ext == "jpe";
				}

				function MakeCaption(path)
				{
				    return GetNameFromPath(path);
				}

				function GetNameFromPath(path)
				{
				    var delim = path.lastIndexOf("\\");
				    if (delim == -1) {
					delim = path.lastIndexOf("/");
				    }
				    if (delim == -1) {
					delim = path.lastIndexOf(":");
				    }
				    if (delim == -1) {
					return path;
				    }
				    return path.substring(delim + 1);
				}

				function BeginSending()
				{
				    uploading = true;
				    ShowSending();
				}

				function ShowSending()
				{
				    var fileInfo = uploadFileInfo;
				    
					if(!fileInfo || !fileInfo.length) return;
					
				    var files = false;
				    var photos = false;
				    
					for(var i=0; i<fileInfo.length; i++)
					{
						if(fileInfo[i].share == "A") files = true;
						else photos = true;
					}

				    var filesOnly = files && !photos;
				    var photosOnly = photos && !files;
				    var both = photos && files;
					var sUploadMessage = "";
										
					if(filesOnly) sUploadMessage = "Please wait while we upload the files attached to your message. Please be patient and do not leave this page while we upload the files.";
					else if(photosOnly) sUploadMessage = "Please wait while we upload the photos included in your message. Please be patient and do not leave this page while we upload the photos.";
					else if(both) sUploadMessage = "Please wait while we upload the photos and files included in your message. Please be patient and do not leave this page while we upload the photos and files.";

					document.getElementById("uploadmessage").innerHTML = sUploadMessage;

					var oPhotoMailPromoSendMessage = document.getElementById("photomailpromosendmessage");
					
				    if(photos || both)
					{
						oPhotoMailPromoSendMessage.innerHTML = "Although this process may take time, your friends will thank you for making it so easy to view your photos. Each photo you insert links to a large version on Yahoo! Photos. That means no big downloads, no clogged inboxes or oversized photos for your friends. Plus they can print or save your photos for themselves.";
						oPhotoMailPromoSendMessage.parentNode.style.display = "inline";
					}
					else oPhotoMailPromoSendMessage.parentNode.style.display = "none";


					
				    document.all.stuff.style.display = "none";
				    document.all.sending.style.display = "inline";
				}

				function HideSending()
				{
				    document.all.sending.style.display = "none";
				    document.all.stuff.style.display = "inline";
				}

				function SetHtml()
				{
					editor.SetHTML(document.Compose.PlainMsg.value);
				}
	
				function RestoreBackground()
				{
						editor.SetBackgroundImage("");
				}
	
				function SetVals()
				{
					document.Compose.Body.value = editor.GetHTML();
				}

				function SetValsDraft()
				{
					document.Compose.Body.value = editor.GetHTML();
				}

				function SetBGM()
				{
					if (typeof BGMPlayer.formbgm == "undefined") return;
					editor.SetDomain("sanmacs.com");
					document.domain = "eduage.org";
					var BGM = BGMPlayer.formbgm;
					document.Compose.BGMid.value = BGM.bgmid.value;
					document.Compose.BGMtitle.value = BGM.bgmtitle.value;
					document.Compose.BGMinfo.value = BGM.bgminfo.value;
				}

				function CheckMusicMail()
				{
					if (typeof BGMPlayer.formbgm == "undefined") {
						document.all.BGMPlayer.width = 0;
						document.all.BGMPlayer.height = 0;
					}
				}

				function OnBeforeUnload()
				{
				    SaveMsg();
					SaveBrowseState();
				    if(uploading) {
					uploadCancelled = true;
					document.all.browse.Cancel();
				    }
				}
	
				function SaveMsg()
				{
					if( self.name != "ymailcompose")
					{
						if (typeof document.Compose != "undefined" && typeof document.Compose.PlainMsg != "undefined")
						{
							document.Compose.PlainMsg.value = editor.GetHTML();
						}
					}
				}
	
				function SetBackground(ref, desc, def, fg, ff, fs, solid, custom)
				{
					document.Compose.BGRef.value = ref;
					document.Compose.BGDesc.value = desc;
					document.Compose.BGDef.value = def;
					document.Compose.BGFg.value = fg;
					document.Compose.BGFF.value = ff;
					document.Compose.BGFS.value = fs;
					document.Compose.BGSolid.value = solid ? "1" : "0";
					document.Compose.BGCustom.value = custom ? "1" : "0";
				
					if(solid) editor.SetBackgroundColor(ref);
					else editor.SetBackgroundImage(custom ? ("/ym/Stationery?Data=" + ref + "&UrlExtras") : ref);
				
					editor.SetForegroundColor(fg);
					editor.SetFontFamily(ff);
					editor.SetFontSize(fs);
				}
			
				function RemoveBackground()
				{
					document.Compose.BGRef.value = "";
					document.Compose.BGSolid.value = "";
					document.Compose.BGCustom.value = "";
					editor.RemoveBackgroundColor();
					editor.RemoveBackgroundImage();
					editor.RemoveForegroundColor();
					editor.RemoveFontFamily();
					editor.RemoveFontSize();
				}
			
				function GetBackground()
				{
					return{
						ref: document.Compose.BGRef.value,
						desc: document.Compose.BGDesc.value,
						def: document.Compose.BGDef.value,
						fg: document.Compose.BGFg.value,
						ff: document.Compose.BGFF.value,
						fs: document.Compose.BGFS.value,
						solid: document.Compose.BGSolid.value == "1",
						custom: document.Compose.BGCustom.value == "1"
					};
				}
			
			    var oldBackground = null;
			
				function SaveOldBackground()
				{
					oldBackground = GetBackground();
				}
			
				function RestoreOldBackground()
				{
					if(oldBackground)
					{
						RemoveBackground();
						SetBackground(oldBackground.ref,oldBackground.desc,oldBackground.def,oldBackground.fg,oldBackground.ff,oldBackground.fs,oldBackground.solid,oldBackground.custom);
					}
				}
				

			function setDocumentCharset()
			{
				var oForm = document.Compose;
                                var charset = (typeof document.charset == "undefined" ||                       
                                               document.charset == null) ? document.characterSet : document.charset;

                                if(oForm.docCharset.value != charset)          
                                    oForm.docCharset.value = charset;          
                                else
                                    oForm.docCharset.value = "";          
			}

			function Send()
			{
				PostProcess ();

				var oForm = document.Compose;
			
				SetVals();

				if (typeof AC_PostProcess == "function")
					AC_PostProcess();

                /*if user modifies encoding in the browser*/
                setDocumentCharset();
                oForm.SEND.value = "1";
                oForm.submit();
			}

			function Send_Click()
			{
                if(!Compose_Submit()) return;
            
				if (document.Compose.To.value == "") {
				    ShowSendError("NoTo");
				    return;
				}
				HideSendError();
				if (g_bGoodBrowse) {
				    var fi = document.all.browse.FileInfo("");
				    var fileInfo = ParseFileInfo(fi);

				    if (fileInfo && fileInfo.length) {
					var styInfo = GetSaveToYahooAlbumInfo();
					
					if(styInfo && styInfo.save)
					{
						if(styInfo.caption.length > 0)
						{
							SetSaveToYahooBrowseParam(styInfo.save, styInfo.path, styInfo.caption, styInfo.isNew);
						}
						else
						{
							alert("Please specify an album to upload your photos to.");
							return;
						}
					}
					else
					    SetSaveToYahooBrowseParam(false, null, null, false);	

					var browse = document.all.browse;
					browse.SetParam(
					    "mailfrom", 
					    "delhi_kapil@yahoo.com"
					);
					browse.SetParam(
					    "mailsubj", 
					    document.Compose.Subj.value
					);
					Reorder();
					if(thumbnails.length > 0) SyncCaptions();
					SaveBrowseState();
					uploadCancelled = false;
					browse.Upload();

					uploadFileInfo = fileInfo;
					BeginSending();
					return;
				    }
				}

				Send();
			}

			function GetSaveToYahooAlbumInfo()
			{
				var saveToYahoo = '';
				if(saveToYahoo == "1")
					return editor.GetSaveToAlbumInfo(); //Save to user selected album 		
				else if (saveToYahoo == "2")
					return GetDefaultAlbumInfo(); //save to default photomail
				return null; //don't save to yahoo					
			}

			function SaveDraft_Click(p_oSender)
			{
				var a = false;
				var p = false;

				var m = "";
				if (a && p) {
				    m = "Attachments and PhotoMail cannot be saved as a draft. Selected attachments and photos will be removed.";
				}
				else if (a) {
				    m = "Attachments cannot be saved as a draft. Selected attachments will be removed.";
				}
				else if (p) {
				    m = "PhotoMail cannot be saved as a draft. Selected photos will be removed.";
				}

				if(m != "" && !confirm(m)) return;
				 PostProcess();

				var oForm = p_oSender.form;

				SetValsDraft();

				oForm.SD.value = p_oSender.value;
				oForm.submit();
			}

			function SpellCheck_Click()
			{
				PostProcess ();

				SetVals();

				if (g_bGoodBrowse) {
					SaveBrowseState();
					SaveAttachments();
				}

				document.Compose.SC.value = "1";
				document.Compose.submit();
			}
			
			function leaveComposeOK()
			{
				var isEmpty = true;		// Let's assume that it IS empty
				
				/*
				 *  The message is not considered empty if any of the to, cc or bcc
				 *  fields has been filled in...
				 */
				// Declare an associative array so that we can use "in"

				/*
				 * Checking the content could be costly.  Don't bother if 
				 * we already know this message isn't empty...
				 */
				if ( isEmpty && editor.GetText() != "" ) {
					isEmpty = false;
				}
				
				if ( ! isEmpty ) {
				    return confirm("Are you sure you want to stop composing this message? All message contents will be lost.");
				}
				return true;
			}

			function Cancel_Click(p_oSender)
			{
//				if (editor.GetHTML() != "") {
				if ( ! leaveComposeOK() ) {
					return;
				}
				
				PostProcess ();

				var oForm = p_oSender.form;
				oForm.CAN.value = p_oSender.value;
				oForm.submit();
			}			
			
			function PostProcess () {
				if(typeof AC_CleanRecipientValue != "function") return;
			}

			

			function Compose_DragDrop(file, width, height, widThumb, heightThumb)
			{
				//document.all('htmlInfo').value = "dragdrop of file" + file;
				//if(width == -1)
				//alert(file);
				
				Compose.EventHandled(true);
			}

			function SetFocus()
			{
				if(gReplyForward != "Reply" )
				{	
				}
				
				if(gReplyForward == "Reply") editor.SetInitialFocus();
			}
            
            function Window_Resize()
            {
                editor.SetHeight();
            }
            
			function OnLoad()
			{
				if(self.name == "ymailcompose") return;

				initializeInstacompose();

						if( !g_bGoodBrowse )
							loadAutocomplete();
 
				
				SetHtml();
				if(g_bGoodBrowse)
				    editor.SetComposeReadyCB(RestoreBackground);
				else
				    RestoreBackground();
				
				SetFocus();
			
				document.Compose.ATT.value = "";
				


							


			}


    function ShowEmptyFieldWarning(p_sMessage, p_sOption, p_sField)
    {
        var bSubmit = false;            

        if(window.showModalDialog)
        {
			var sURI = "ym";
			var sURLExtras = "YY=86217&order=down&sort=date&pos=0";

            var oArguments = {
                Message : p_sMessage
            };

            var oAction = window.showModalDialog("/"+sURI+"/Static?file=ConfirmationDialog.html",oArguments,"dialogHeight:150px;dialogWidth:500px;status:no;help:no;resizable:yes;scroll:no;");
            
            if(oAction.remember)
            {
                window.open("/"+sURI+"/Asynch?op="+p_sOption+"&"+sURLExtras,"asynch");
                g_oWarnings[p_sField] = false;
		refreshInstaCompose()
            }

            bSubmit = oAction.confirmed;
        }
        else bSubmit = confirm(p_sMessage);
        
        return bSubmit;
    }

    function FieldIsBlank(p_sId)
    {
        var oElement = document.getElementById(p_sId);

        if(oElement != null)
        {
            var sValue = oElement.value;
            oElement = null;
            return (sValue.length == 0);
        }    
    }

    g_oWarnings = new Object();

    g_oWarnings["subjectfield"] = true;
    g_oWarnings["bodyfield"] = true;

    function Compose_Submit()
    {
        var bSubmit = true;
        var sMessage = "";

        if(g_oWarnings["subjectfield"] && FieldIsBlank("subjectfield"))
        {
            sMessage = "This message has no subject. Are you sure you want to send it?";
            bSubmit = ShowEmptyFieldWarning(sMessage, "nosubjwarn", "subjectfield");
        }

		/*
		var messageHtml = editor.GetHTML();
		messageHtml = messageHtml.replace( /<p(\s+[^>]*)>/gi, "<div>" );  
		messageHtml = messageHtml.replace( /<p\s*>/gi, "<div>" );  
		messageHtml = messageHtml.replace( /<\/p>/gi, "</div>" );
		editor.SetHTML( messageHtml );
		 */
		
        if(g_oWarnings["bodyfield"] && editor.GetHTML() == "") 
        {
            sMessage = "Are you sure you want to send an empty message?"; 
            bSubmit = ShowEmptyFieldWarning(sMessage, "nobodywarn", "bodyfield");
        }

        return bSubmit;        
    }

		
	function InstallFieldUpdater ( field ) {

		if ( typeof field == "string" ) field = document.getElementById ( field );
		if ( field == null || field.tagName != "TEXTAREA" )
			return;

		if ( field.attachEvent ) { // IE
			field.attachEvent ( "onfocus", DoUpdateFieldHeight );
			field.attachEvent ( "onkeyup", DoUpdateFieldHeight );
			field.attachEvent ( "onmouseup", DoUpdateFieldHeight );
			field.attachEvent ( "onselect", DoUpdateFieldHeight );

			field.attachEvent ( "oncut", DoUpdateFieldHeight );
			field.attachEvent ( "onpaste", DoUpdateFieldHeight );

		} else if ( field.addEventListener ) { // Moz/W3
			field.addEventListener ( "focus", DoUpdateFieldHeight, true );
			field.addEventListener ( "keyup", DoUpdateFieldHeight, true );
			field.addEventListener ( "mouseup", DoUpdateFieldHeight, true );
			field.addEventListener ( "select", DoUpdateFieldHeight, true );
		}
		UpdateFieldHeight(field);
	}

	function DoUpdateFieldHeight ( evt ) {
		if ( evt == null ) evt = window.event;
		if ( evt == null ) return;
		var target = ( evt.srcElement ? evt.srcElement : evt.target );
		if ( target == null ) return;

		// allow layout changes to settle:
		setTimeout ( "UpdateFieldHeight('" + target.id + "')", 10 );
	}

	function UpdateFieldHeight( field, maxHeight ) {

		if ( typeof field == "string" ) field = document.getElementById ( field );
		if ( field == null || field.tagName != "TEXTAREA" )
			return;


		if ( maxHeight == null ) maxHeight = 200;

		var clientHeight = parseInt( field.clientHeight );
		var scrollHeight = parseInt( field.scrollHeight );

		if (( Math.abs( clientHeight - scrollHeight ) > 4 ) ||
				( clientHeight < scrollHeight )) { // second case added to clear up problems where the text area
												   // initializes to slightly smaller than the appropriate height

			scrollHeight += 4; // TEXTAREA frame

			if ( ( maxHeight != null ) && ( scrollHeight > maxHeight ) )
				scrollHeight = maxHeight;

			if ( scrollHeight != field.offsetHeight )
				field.style.height = scrollHeight + "px";
		}
	}

	function DisplayElement ( elt, displayValue ) {
		if ( typeof elt == "string" )
			elt = document.getElementById( elt );
		if ( elt == null ) return;

		if ( oBw && oBw.ns6 ) {
			// OTW table formatting will be lost:
			if ( displayValue == "block" && elt.tagName == "TR" )
				displayValue = "table-row";
			else if ( displayValue == "inline" && elt.tagName == "TR" )
				displayValue = "table-cell";
		}

		elt.style.display = displayValue;
	}

	function AddCC ( doFocus ) {
		DisplayElement ( "ccrow", "block" );
		DisplayElement ( "cclink", "none" );
		DisplayElement ( "cclink2", "inline" );
		
		if ( doFocus )
		{
			var field = window.document.getElementById( "ccfield" );
			if ( field != null )
				field.focus();
		}
        
        document.Compose.showcc.value = "1";
	}

	function RemoveCC () {
		if ( document.Compose.ccfield.value != "" )
			if ( !confirm ( "Remove all CC addresses you've entered?" ) )
				return;

		document.Compose.ccfield.value = "";
		UpdateFieldHeight ( document.Compose.ccfield );

		DisplayElement ( "ccrow", "none" );
		DisplayElement ( "cclink2", "none" );
		DisplayElement ( "cclink", "inline" );

        document.Compose.showcc.value = "0";
	}

	function AddBCC ( doFocus ) {
		DisplayElement ( "bccrow", "block" );
		DisplayElement ( "bcclink", "none" );
		DisplayElement ( "bcclink2", "inline" );

		if ( doFocus )
		{
			var field = window.document.getElementById( "bccfield" );
			if ( field != null )
				field.focus();
		}
        
        document.Compose.showbcc.value = "1";
	}

	function RemoveBCC () {
		if ( document.Compose.bccfield.value != "" )
			if ( !confirm ( "Remove all BCC addresses you've entered?" ) )
				return;

		document.Compose.bccfield.value = "";
		UpdateFieldHeight ( document.Compose.bccfield );

		DisplayElement ( "bccrow", "none" );
		DisplayElement ( "bcclink2", "none" );
		DisplayElement ( "bcclink", "inline" );

        document.Compose.showbcc.value = "0";
	}

    function Help(link)
    {
		window.open(link,"help","width=400,height=500,scrollbars=yes,dependent=yes");
    }

    /*
	if(document.cookie != "" && document.cookie.indexOf("//fRDB") == -1) 
    {
	if(self.name != "ymailcompose")
		window.open("http://mail.yahoo.com", "_top");
	else
		parent.refreshCompose();
    }
	
	*/
    var newWin=null;
    var onscreen=false;

    function NewWin(url,name,xpos,ypos,width,height)
    {
       newWin=window.open(
           url,
           name,
           "screenX="+xpos+",screenY="+ypos+",WIDTH="+width+",HEIGHT="+height+ 
           ",location=0,resizable=1,status=0,titlebar=1,directories=0,toolbar=0,menubar=0,scrollbars=0,status=0"
       );
       newWin.focus();
       onscreen=true; 
    }

    var oKey = new ylib_keyevt();
    oKey.addKey(67,-1,"location='http://us.f527.mail.yahoo.com/ym/ShowFolder?rb=Inbox&YY=86217&order=down&sort=date&pos=0&YN=1'","shift+ctrl"); // Check Mail | CTRL-C
    try
    {
    if( parent.showCompose )
        oKey.addKey(80,-1,"try {parent.showCompose();} catch(e) {location='http://us.f527.mail.yahoo.com/ym/Compose?YY=86217&order=down&sort=date&pos=0';}","shift+ctrl"); // Compose | CTRL-P
    else
        oKey.addKey(80,-1,"location='http://us.f527.mail.yahoo.com/ym/Compose?YY=86217&order=down&sort=date&pos=0'","shift+ctrl"); // Compose | CTRL-P
    }
    catch(error)
    {
        oKey.addKey(80,-1,"location='http://us.f527.mail.yahoo.com/ym/Compose?YY=86217&order=down&sort=date&pos=0'","shift+ctrl"); // Compose | CTRL-P
    }

    oKey.addKey(70,-1,"location='http://us.f527.mail.yahoo.com/ym/Folders?YY=86217&order=down&sort=date&pos=0'","shift+ctrl"); // Folders | CTRL-F
    oKey.addKey(83,-1,"location='http://us.f527.mail.yahoo.com/ym/Search?P=1&YY=86217&order=down&sort=date&pos=0'","shift+ctrl"); // Search | CTRL-S
        oKey.addKey(72,-1,"location='http://help.yahoo.com/help/us/mail'","shift+ctrl"); // Help | CTRL-H


    function init() 
    { 
		if(document.getElementById)
		{
			Tabs_Init();
			LeftNav('popaccounts');
			LeftNav('mailaccounts');
			LeftNav('folderlist');
			LeftNav('searchnav');
			LeftNav('optionsnav');
            LeftNav('savedsearches');
			
	    	document.onkeydown = function(evt) { oKey.keyevent(evt); }
			if(typeof OnLoad != 'undefined') OnLoad();
		}
    }

    onload=init

						function GetField( field )
						{
							return document.Compose.elements[ field ].value;
						}
						
						function SetField( field, contents )
						{
							if ( field == 'Cc' && document.getElementById( "cclink2" ).style.display == "none" )
							{
								AddCC( );
							}

							if ( field == 'Bcc' && document.getElementById( "bcclink2" ).style.display == "none" )
							{
								AddBCC( );
							}

							document.Compose.elements[ field ].value = contents;

							UpdateFieldHeight ( document.Compose.elements[ field ] );
					}

		g_bGoodBrowse = false; // Global variable indicating whether or not the user has the browse control installed
		g_oBrowse = null; // Global reference to the browse control